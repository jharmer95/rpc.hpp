option(BUILD_NJSON_ADAPTER "Build the adapter for nlohmann/json" ON)

if(${BUILD_NJSON_ADAPTER})
  if(${USE_CONAN})
    set(CONAN_EXTRA_REQUIRES nlohmann_json/[>=3.5.0])
    run_conan()
    add_library(njson_lib INTERFACE)
    target_link_libraries(njson_lib INTERFACE CONAN_PKG::nlohmann/json)
  else()
    add_library(njson_lib INTERFACE)
    find_path(njson_path nlohmann/json.hpp)
    target_include_directories(njson_lib INTERFACE njson_path)
  endif()

  add_library(njson_adapter INTERFACE)
  target_include_directories(njson_adapter INTERFACE "${PROJECT_SOURCE_DIR}/include")
  target_link_libraries(njson_adapter INTERFACE ${CMAKE_THREAD_LIBS_INIT})
  install(FILES "rpc_njson.hpp" DESTINATION "${CMAKE_INSTALL_PREFIX}/include/rpc_adapters")
endif()
